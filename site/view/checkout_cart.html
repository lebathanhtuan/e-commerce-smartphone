<!doctype html>
<html lang="en">
    <head>
        <title>Kiểm tra giỏ hàng</title>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css">
        <link rel="stylesheet" href="../../public/css/style.css">
    </head>
    <body style="background-color: #f1f1f1">
        <nav class="navbar navbar-expand-md bg-dark navbar-dark">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="#">DiDongXanh</a>
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="../../index.html">Trang Chủ</a>
                    </li>   
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            Điện thoại
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="#">Link 1</a>
                            <a class="dropdown-item" href="#">Link 2</a>
                            <a class="dropdown-item" href="#">Link 3</a>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            Laptop
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="#">Link 1</a>
                            <a class="dropdown-item" href="#">Link 2</a>
                            <a class="dropdown-item" href="#">Link 3</a>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            Máy tính bảng
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="#">Link 1</a>
                            <a class="dropdown-item" href="#">Link 2</a>
                            <a class="dropdown-item" href="#">Link 3</a>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            Phụ kiện
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="#">Link 1</a>
                            <a class="dropdown-item" href="#">Link 2</a>
                            <a class="dropdown-item" href="#">Link 3</a>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Tin tức</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Tìm kiếm</a>
                    </li>    
                </ul>
            </div>
            <div class="container-nav-right">
                <a class="navbar-brand" href="#">Bar</a>
                <a class="navbar-brand" href="../E-Commerce/site/view/login.html">Login</a>
            </div>            
        </nav>
        <div class="container">
            <div class="container-checkout">
                <div class="container-checkout-head">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="checkout checkout-active">
                                <div class="checkout-number">1</div>
                                <div class="checkout-info">
                                    <div class="checkout-title">Kiểm tra</div>
                                    <div class="checkout-desc">Giỏ hàng của bạn</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="checkout">
                                <div class="checkout-number">2</div>
                                <div class="checkout-info">
                                    <div class="checkout-title">Thông tin</div>
                                    <div class="checkout-desc">Cá nhân và địa chỉ</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="checkout">
                                <div class="checkout-number">3</div>
                                <div class="checkout-info">
                                    <div class="checkout-title">Xác nhận</div>
                                    <div class="checkout-desc">Dịch vụ thanh toán</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="checkout">
                                <div class="checkout-number">4</div>
                                <div class="checkout-info">
                                    <div class="checkout-title">Hoàn tất</div>
                                    <div class="checkout-desc">Hóa đơn mua hàng</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container-checkout-main">
                    <div class="table-responsive">
                        <table class="table table-hover" id="bar-product">
                            <tr>
                                <th colspan="2">Tên sản phẩm</th>
                                <th>Màu sắc</th>
                                <th>Giá tiền</th>
                                <th>Số lượng</th>
                                <th>Tổng</th>
                            </tr>
                        </table>
                        <div class="total-cart float-right">
                            <table class="table">
                                <tr class="text-right">
                                    <td class="pr-5">Tổng tiền giỏ hàng</td>
                                    <td>
                                        <span class="displayTotalBar"></span><span>&nbsp;VND</span>
                                    </td>
                                </tr>
                                <tr class="text-right">
                                    <td class="pr-5 form-group">
                                        <select id="typeShipper" class="custom-select">
                                            <option value="20000" selected>Phí giao hàng tiết kiệm</option>
                                            <option value="50000">Phí giao hàng nhanh</option>
                                        </select>
                                    </td>
                                    <td>
                                        <span class="displayMoneyShip"></span><span>&nbsp;VND</span>
                                    </td>
                                </tr>
                                <tr class="text-right">
                                    <td class="pr-5 h5">Tổng hóa đơn thanh toán</td>
                                    <td class="h5">
                                        <span class="displayTotalPay"></span><span>&nbsp;VND</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="container-checkout-footer">
                    <a href="product_detail.html"><input type="button" class="btn btn-secondary float-left" value="Trở lại"></a>
                    <a href="checkout_info.html"><input type="submit" class="btn btn-primary float-right" value="Tiếp theo"></a>
                </div>
            </div>
        </div>
        <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js"></script>
        <script src="../../public/js/simple.money.format.js"></script>
        <script>
            $(document).ready(function(){
                $.getJSON('../../db/bar.json', function(data){
                    $.each($(data), function(i, bar){
                        $("#bar-product").append(
                            '<tr>'+
                                '<td class="table-middle"><div class="img-product-bar" style="background: url('+bar.imgCover+') no-repeat; background-position: 50% 50%; background-size: cover;"></div></td>'+
                                '<td class="table-middle">'+bar.name+'</td>'+
                                '<td class="table-middle">'+bar.color+'</td>'+
                                '<td class="table-middle">'+
                                    '<input type="text" style="display: none" name="name['+bar.id+']" value="'+bar.price+'" disabled="disabled">'+
                                    '<span class="displayPrice">'+bar.price+'</span><span>&nbsp;VND</span>'+
                                '</td>'+
                                '<td class="table-middle tb-munber">'+
                                    '<div class="input-group">'+
                                        '<div class="input-group-prepend">'+
                                            '<button class="btn btn-outline-secondary btn-number" type="button" data-type="minus" data-field="['+bar.id+']"><b>-</b></button>'+  
                                        '</div>'+
                                        '<input type="text" style="width: 40px; text-align: center" name="['+bar.id+']" value="1" min="0" max="99">'+
                                        '<div class="input-group-append">'+
                                            '<button class="btn btn-outline-secondary btn-number" type="button" data-type="plus" data-field="['+bar.id+']"><b>+</b></button>'+  
                                        '</div>'+
                                    '</div>'+
                                '</td>'+
                                '<td class="table-middle tb-munber">'+
                                    '<input id="total" type="text" style="display: none" name="total['+bar.id+']" value="'+bar.price+'" disabled="disabled">'+
                                    '<span class="displayTotal">'+bar.price+'</span><span>&nbsp;VND</span>'+
                                '</td>'+
                            '</tr>'
                        );
                    });
                    var arrayTotal = new Array(); 
                    var totalBar = 0;
                    var totalPay = 0;

                    function add(a, sum){
                        return sum + a;
                    };
                    
                    function sumTotal(){
                        var moneyShip = parseInt($("#typeShipper").val());

                        for (i = 0; i < $("table").find('input[id="total"]').length; i++){
                            arrayTotal[i] = parseInt($("table").find('input[id="total"]')[i].value);
                        }
                        totalBar = arrayTotal.reduce(add,0);
                        $(".displayTotalBar").text(totalBar);
                        $(".displayTotalBar").simpleMoneyFormat();
                        if(totalBar == 0){
                            moneyShip = 0;
                        }
                        totalPay = totalBar + moneyShip;
                        $(".displayTotalPay").text(totalPay);
                        $(".displayTotalPay").simpleMoneyFormat();
                        $(".displayMoneyShip").text(moneyShip);
                        $(".displayMoneyShip").simpleMoneyFormat();

                        $("#typeShipper").change(function(){
                            var moneyTypeShip = parseInt($("#typeShipper").val());
                            if(totalBar == 0){
                                moneyShip = 0;
                            }else{
                                moneyShip = moneyTypeShip;
                            }
                            totalPay = totalBar + moneyShip;
                            $(".displayTotalPay").text(totalPay);
                            $(".displayTotalPay").simpleMoneyFormat();
                            $(".displayMoneyShip").text(moneyShip);
                            $(".displayMoneyShip").simpleMoneyFormat();
                        });
                    };
                    sumTotal();

                    $(".displayPrice").simpleMoneyFormat();
                    $(".displayTotal").simpleMoneyFormat();

                    $(".btn-number").click(function(e){        
                        e.preventDefault();                
                        var fieldName = $(this).attr('data-field');        
                        var type      = $(this).attr('data-type');        
                        var inputNumber = $("input[name='"+fieldName+"']");   
                        var currentVal = parseInt(inputNumber.val());
                        var inputPrice = $("input[name='name"+fieldName+"']");
                        var currentValPrice = parseInt(inputPrice.val());
                        var inputTotal = $("input[name='total"+fieldName+"']");
                        if (!isNaN(currentVal)) {            
                            if(type == 'minus') {             
                                var minValue = parseInt(inputNumber.attr('min'));            
                                if(!minValue){
                                    minValue = 0;
                                }                
                                if(currentVal > minValue) {                    
                                    inputNumber.val(currentVal - 1).change();
                                    var currentVal = parseInt(inputNumber.val());
                                    inputTotal.val(currentValPrice*currentVal).change();
                                    $("input[name='total"+fieldName+"']").next().empty();
                                    $("input[name='total"+fieldName+"']").next().append(inputTotal.val()).simpleMoneyFormat();
                                    sumTotal();
                                }                      
                            } 
                            else if(type == 'plus') {                
                                var maxValue = parseInt(inputNumber.attr('max'));                
                                if(!maxValue){
                                    maxValue = 99;
                                }               
                                if(currentVal < maxValue) {                    
                                    inputNumber.val(currentVal + 1).change();
                                    var currentVal = parseInt(inputNumber.val());
                                    inputTotal.val(currentValPrice*currentVal).change();
                                    $("input[name='total"+fieldName+"']").next().empty();
                                    $("input[name='total"+fieldName+"']").next().append(inputTotal.val()).simpleMoneyFormat();
                                    sumTotal();
                                }
                            }        
                        } else {            
                            inputNumber.val(0);    
                        }
                    });
                }); 
            });  
        </script>
    </body>
</html>